<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>

<!-- Navbar Fragment -->
<header class="navbar" th:fragment="navbar">
    <div class="logo">Color Run</div>
    <nav class="menu">
        <a th:href="@{/}" 
           th:class="${#strings.endsWith(#httpServletRequest.requestURI, '/') || #strings.contains(#httpServletRequest.requestURI, 'acceuil')} ? 'active' : ''">Accueil</a>
        
        <a th:href="@{/courses}" 
           th:class="${#strings.contains(#httpServletRequest.requestURI, '/courses')} ? 'active' : ''">Courses</a>
        
        <a th:href="@{/MyCourses}" 
           th:class="${#strings.contains(#httpServletRequest.requestURI, '/MyCourses')} ? 'active' : ''">Mes courses</a>
        
        <a th:href="@{/organizer/request}" 
           th:class="${#strings.contains(#httpServletRequest.requestURI, '/organizer/request')} ? 'active' : ''">Devenir Organisateur</a>
        
        <!-- Affichage conditionnel selon l'√©tat de connexion avec TOKEN -->
        <div th:if="${isAuthenticated}">
            <!-- Utilisateur connect√© via TOKEN -->
            <div style="display:flex; align-items:center; gap:12px; margin-left:24px;">
                <span style="color:#6a82fb; font-weight:600;" th:text="'üëã ' + ${userName}">üëã Utilisateur</span>
                <span style="background:#28a745; color:white; padding:2px 6px; border-radius:8px; font-size:0.8rem; font-weight:600;" th:text="${userRole}">
                    ROLE
                </span>
                
                <!-- Menu selon le r√¥le -->
                <a th:if="${isAdmin}" th:href="@{/admin}" 
                   style="color:#dc3545; text-decoration:none; font-weight:600; margin-left:8px;">üõ†Ô∏è Admin</a>
                
                <th:block th:if="${isOrganizer}">
                    <a th:href="@{/creation-course}" 
                       style="color:#007bff; text-decoration:none; font-weight:600; margin-left:8px;">‚ûï Cr√©er</a>
                    <a th:href="@{/MyCourses}" 
                       style="color:#007bff; text-decoration:none; font-weight:600;">üìã Mes courses</a>
                </th:block>
                
                <a th:href="@{/logout}" 
                   style="color:#ff6a88; text-decoration:none; font-weight:600; margin-left:8px;">üö™ D√©connexion</a>
            </div>
        </div>
        
        <div th:unless="${isAuthenticated}">
            <!-- Utilisateur non connect√© -->
            <a href="#" class="account-icon" title="Mon compte" style="margin-left:24px;" onclick="openAccountPopup()">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none" style="display:inline-block;vertical-align:middle;" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="14" cy="14" r="13" stroke="#6a82fb" stroke-width="2" fill="#fff"/>
                    <circle cx="14" cy="11" r="5" fill="#e2e7ff" stroke="#6a82fb" stroke-width="1.5"/>
                    <path d="M6 22c1.5-4 14.5-4 16 0" stroke="#6a82fb" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                </svg>
            </a>
        </div>
    </nav>
</header>

<!-- Popup compte utilisateur (connexion/inscription) - UNIQUEMENT pour les utilisateurs non connect√©s -->
<div th:unless="${isAuthenticated}" id="account-popup-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.38); z-index:9999;">
    <div id="account-popup" style="position:fixed; top:0; right:0; width:370px; max-width:100vw; height:100vh; background:#fff; box-shadow:-2px 0 24px rgba(0,0,0,0.10); z-index:10000; display:flex; flex-direction:column; align-items:center; padding:32px 28px 0 28px;">
        <button onclick="closeAccountPopup()" style="position:absolute; top:18px; right:24px; background:none; border:none; font-size:1.5rem; color:#ff6a88; cursor:pointer;">√ó</button>
        <img th:src="@{/images/logo.png}" alt="Logo Color Run" style="height:38px; margin-bottom:32px; margin-top:8px;">
        
        <!-- Contenu de connexion -->
        <div id="account-popup-content">
            <h2 style="font-size:1.15rem; margin-bottom:18px; text-align:left;">Se connecter</h2>
            <form th:action="@{/login}" method="POST">
                <label style="font-size:0.98rem; font-weight:600;">Adresse email :</label>
                <input type="email" name="email" required style="width:100%; margin-bottom:16px; margin-top:4px; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:1rem;">
                <label style="font-size:0.98rem; font-weight:600;">Mot de passe :</label>
                <input type="password" name="password" required style="width:100%; margin-bottom:24px; margin-top:4px; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:1rem;">
                <button type="submit" class="search-button" style="width:100%; margin-bottom:18px;">Se connecter</button>
            </form>
            <div style="text-align:center; font-size:0.95rem;">
                Tu n'as pas de compte ? <a href="#" id="show-register" style="color:#6a82fb; text-decoration:underline; cursor:pointer;">Cr√©er le tien</a>
            </div>
        </div>
        
        <!-- Contenu d'inscription -->
        <div id="register-popup-content" style="display:none; width:100%;">
            <h2 style="font-size:1.15rem; margin-bottom:18px; text-align:left;">Cr√©er un compte</h2>
            <form th:action="@{/register}" method="POST">
                <label style="font-size:0.98rem; font-weight:600;">Nom :</label>
                <input type="text" name="lastName" required style="width:100%; margin-bottom:12px; margin-top:4px; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:1rem;">
                <label style="font-size:0.98rem; font-weight:600;">Pr√©nom :</label>
                <input type="text" name="firstName" required style="width:100%; margin-bottom:12px; margin-top:4px; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:1rem;">
                <label style="font-size:0.98rem; font-weight:600;">Adresse email :</label>
                <input type="email" name="email" required style="width:100%; margin-bottom:12px; margin-top:4px; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:1rem;">
                <label style="font-size:0.98rem; font-weight:600;">Mot de passe :</label>
                <input type="password" name="password" required style="width:100%; margin-bottom:20px; margin-top:4px; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:1rem;">
                <button type="submit" class="search-button" style="width:100%; margin-bottom:18px;">S'inscrire</button>
            </form>
            <div style="text-align:center; font-size:0.95rem;">
                Tu as d√©j√† un compte ? <a href="#" id="show-login" style="color:#6a82fb; text-decoration:underline; cursor:pointer;">Connecte-toi</a>
            </div>
        </div>
    </div>
</div>

<script th:unless="${isAuthenticated}">
    function openAccountPopup() {
        document.getElementById('account-popup-overlay').style.display = 'block';
        document.getElementById('account-popup-content').style.display = 'block';
        document.getElementById('register-popup-content').style.display = 'none';
    }
    
    function closeAccountPopup() {
        document.getElementById('account-popup-overlay').style.display = 'none';
    }
    
    // Initialisation des √©v√©nements
    document.addEventListener('DOMContentLoaded', function() {
        const showRegister = document.getElementById('show-register');
        const showLogin = document.getElementById('show-login');
        const overlay = document.getElementById('account-popup-overlay');
        
        if (showRegister) {
            showRegister.onclick = function(e) {
                e.preventDefault();
                document.getElementById('account-popup-content').style.display = 'none';
                document.getElementById('register-popup-content').style.display = 'block';
            };
        }
        
        if (showLogin) {
            showLogin.onclick = function(e) {
                e.preventDefault();
                document.getElementById('register-popup-content').style.display = 'none';
                document.getElementById('account-popup-content').style.display = 'block';
            };
        }
        
        if (overlay) {
            overlay.onclick = function(e) {
                if (e.target === this) closeAccountPopup();
            };
        }
    });
</script>

</body>
</html> 